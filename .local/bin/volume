#!/bin/sh -eu
# Simple volume control.

usage() {
  echo "Usage: $(basename $0) <percent/+percent/-percent/up/down/off>"
  echo
  exit 0
}

step=5

set_volume() {
  case "$1" in
    [+-]*)
        pactl set-sink-volume @DEFAULT_SINK@ $1% 
        ;;

    up)
        current=$(get_volume)
        if [ "$current" -lt 150 ]; then
          new=$((current + step))
          [ "$new" -gt 150 ] && new=150
          pactl set-sink-volume @DEFAULT_SINK@ $new%
        fi
        ;;

    down)
        pactl set-sink-volume @DEFAULT_SINK@ -$step% 
        ;;

    off)
        pactl set-sink-volume @DEFAULT_SINK@ 0
        ;;

    *) # Assume a percent
        pactl set-sink-volume @DEFAULT_SINK@ $1%
        ;;
  esac
}

get_volume() {
  echo $(pactl get-sink-volume @DEFAULT_SINK@ | head -n 1 | awk '{print substr($5, 1, length($5)-1)}')
}

case "${1:-}" in
  ""|-h|--help)
    usage
    ;;
  *)
    set_volume $1
    ;;
esac

if [ -n "${WOB_SOCK+set}" ]; then
  echo $(get_volume) > $WOB_SOCK
fi 
