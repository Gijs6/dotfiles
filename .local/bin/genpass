#!/usr/bin/env python
import argparse
import secrets
import string


def generate_password(length: int, charset: str) -> str:
    return "".join(secrets.choice(charset) for _ in range(length))


def main():
    parser = argparse.ArgumentParser(
        description="Generate cryptographically secure random passwords",
        formatter_class=argparse.RawDescriptionHelpFormatter,
    )
    parser.add_argument(
        "-l",
        "--length",
        type=int,
        default=25,
        metavar="N",
        help="password length (default: 25)",
    )
    parser.add_argument(
        "-c",
        "--charset",
        choices=["alnum", "ascii", "hex", "safe", "letters", "upper", "lower", "digits"],
        default="safe",
        metavar="TYPE",
        help="character set: alnum (A-Za-z0-9), ascii (all printable), "
        "hex (0-9a-f), safe (bash-safe: A-Za-z0-9_.-,/:), "
        "letters (A-Za-z), upper (A-Z), lower (a-z), digits (0-9) (default: safe)",
    )
    parser.add_argument(
        "--no-ambiguous",
        action="store_true",
        help="exclude ambiguous characters (0O1lIS52ZB8)",
    )
    args = parser.parse_args()

    if args.charset == "alnum":
        charset = string.ascii_letters + string.digits
    elif args.charset == "hex":
        charset = string.hexdigits.lower()[:16]
    elif args.charset == "ascii":
        charset = string.ascii_letters + string.digits + string.punctuation
    elif args.charset == "letters":
        charset = string.ascii_letters
    elif args.charset == "upper":
        charset = string.ascii_uppercase
    elif args.charset == "lower":
        charset = string.ascii_lowercase
    elif args.charset == "digits":
        charset = string.digits
    else:
        charset = string.ascii_letters + string.digits + "_.-,/:"

    if args.no_ambiguous:
        ambiguous = "0O1lIS52ZB8"
        charset = "".join(c for c in charset if c not in ambiguous)

    print(generate_password(args.length, charset))


if __name__ == "__main__":
    main()
